<div class="expense-report-content">
  <!-- Filters Card -->
  <div class="filters-card">
    <div class="filter-row">
      <div class="filter-group">
        <label class="filter-label">From Date</label>
        <input type="date" [(ngModel)]="filterFromDate" class="filter-input">
      </div>
      <div class="filter-group">
        <label class="filter-label">To Date</label>
        <input type="date" [(ngModel)]="filterToDate" class="filter-input" [min]="filterFromDate">
      </div>
      <div class="filter-group">
        <app-autocomplete-input
          label="Category"
          [labelClass]="'filter-label'"
          [items]="categories"
          placeholder="All Categories"
          (selectedChange)="onCategorySelect($event)"
        ></app-autocomplete-input>
      </div>
    </div>
    <div class="filter-row">
      <div class="filter-group">
        <label class="filter-label">Min Amount</label>
        <input type="number" [(ngModel)]="filterMinAmount" class="filter-input" placeholder="Min">
      </div>
      <div class="filter-group">
        <label class="filter-label">Max Amount</label>
        <input type="number" [(ngModel)]="filterMaxAmount" class="filter-input" placeholder="Max">
      </div>
      <div class="filter-group">
        <label class="filter-label">Payment Mode</label>
        <select [(ngModel)]="filterPaymentMode" class="filter-input">
          <option value="">All Payment Modes</option>
          <option *ngFor="let mode of paymentModes" [value]="mode.name">{{ mode.name }}</option>
        </select>
      </div>
    </div>
    <div class="filter-row">
      <div class="filter-group" *ngIf="filterPaymentMode && getSelectedPaymentMode()?.isBankAccountRequired">
        <label class="filter-label">Bank Account</label>
        <select [(ngModel)]="filterBankAccountId" class="filter-input">
          <option [value]="null">All Bank Accounts</option>
          <option *ngFor="let bank of bankAccounts" [value]="bank.id">{{ bank.bankName }} - {{ bank.accountNumber }}</option>
        </select>
      </div>
      <div class="filter-group">
        <app-autocomplete-input
          label="Created By"
          [labelClass]="'filter-label'"
          [items]="users"
          [displayKey]="'name'"
          placeholder="All Users"
          (selectedChange)="filterCreatedBy = $event?.username || ''"
        ></app-autocomplete-input>
      </div>
    </div>
    <div class="filter-row">
      <div class="filter-actions">
        <button (click)="applyFilters()" class="btn btn-primary">Search</button>
        <button (click)="resetFilters()" class="btn btn-secondary">Reset</button>
        <button (click)="exportPDF()" class="btn btn-secondary"><fa-icon [icon]="faDownload"></fa-icon> Export PDF</button>
      </div>
    </div>
  </div>

  <!-- Report Card -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Expense Report</h3>
    </div>
    <div class="card-body">
      <!-- Summary Section -->
      <div class="report-summary">
        <div class="summary-card">
          <span class="label">Total Expenses</span>
          <span class="value">{{ totalAmount | indianCurrency }}</span>
        </div>
        <div class="summary-card">
          <span class="label">Transactions</span>
          <span class="value">{{ transactionCount }}</span>
        </div>
        <div class="summary-card">
          <span class="label">Avg. Expense</span>
          <span class="value">{{ avgExpenseValue | indianCurrency }}</span>
        </div>
        <div class="summary-card">
          <span class="label">Top Category</span>
          <span class="value">{{ topCategory }}</span>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <p>Loading expenses...</p>
      </div>

      <!-- No Data State -->
      <div *ngIf="!isLoading && filteredExpenses.length === 0" class="no-data-container">
        <p>No expenses found for the selected filters.</p>
      </div>

      <!-- Data Table -->
      <div *ngIf="!isLoading && filteredExpenses.length > 0" class="table-wrapper">
        <div class="mobile-table-scroll">
          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Category</th>
                <th class="text-center">Amount</th>
                <th>Payment Mode</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let expense of filteredExpenses">
                <td>{{ expense.expenseDate | date: 'dd MMM yyyy' }}</td>
                <td><strong>{{ expense.description }}</strong></td>
                <td><span class="category-badge">{{ expense.category }}</span></td>
                <td class="text-center amount">{{ expense.amount | indianCurrency }}</td>
                <td>{{ expense.paymentMode || '-' }}</td>
                <td>
                  <button class="btn-action" (click)="viewDetails(expense)" title="View Details"><fa-icon [icon]="faEye"></fa-icon></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Pagination Controls -->
      <div *ngIf="totalExpenses > 0 && !isLoading" class="pagination">
        <button 
          (click)="onPageChange(currentPage - 1)" 
          [disabled]="currentPage === 1"
          class="btn btn-secondary">
          ← Previous
        </button>
        <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
        <button 
          (click)="onPageChange(currentPage + 1)" 
          [disabled]="currentPage === totalPages"
          class="btn btn-secondary">
          Next →
        </button>
        <div style="display: flex; align-items: center; gap: 0.25rem; margin-left: 2rem;">
          <span class="page-size-label">Show</span>
          <select [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange($event)" class="page-size-select">
            <option *ngFor="let size of [5,10,20,50,100]" [value]="size">{{ size }}</option>
          </select>
          <span class="page-size-label">per page</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Details Modal -->
<div *ngIf="selectedExpense" class="modal-overlay" (click)="closeDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Expense Details #{{ selectedExpense.id }}</h2>
      <button class="modal-close" (click)="closeDetails()">✕</button>
    </div>
    <div class="modal-body">
      <div class="invoice-section">
        <div class="invoice-row">
          <span class="label">Date:</span>
          <span class="value">{{ selectedExpense.expenseDate | date: 'dd MMM yyyy' }}</span>
        </div>
        <div class="invoice-row">
          <span class="label">Description:</span>
          <span class="value">{{ selectedExpense.description }}</span>
        </div>
        <div class="invoice-row">
          <span class="label">Category:</span>
          <span class="value">{{ selectedExpense.category }}</span>
        </div>
        <div class="invoice-row">
          <span class="label">Amount:</span>
          <span class="value">{{ (selectedExpense.amount || 0) | indianCurrency }}</span>
        </div>
        <div class="invoice-row">
          <span class="label">Payment Mode:</span>
          <span class="value">{{ selectedExpense.paymentMode || 'N/A' }}</span>
        </div>
        <div class="invoice-row" *ngIf="selectedExpense.paymentMode && selectedExpense.paymentMode !== 'Cash'">
          <span class="label">Bank Name:</span>
          <span class="value">{{ (selectedExpense.bankAccountName || 'N/A') + ' - ' + (selectedExpense.bankAccountNumber || 'N/A') }}</span>
        </div>
        <div class="invoice-row">
          <span class="label">Notes:</span>
          <span class="value">{{ selectedExpense.notes || 'N/A' }}</span>
        </div>
        <div class="invoice-row">
          <span class="label">Created By:</span>
          <span class="value">{{ getCreatedByName(selectedExpense.createdBy) }}</span>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button (click)="closeDetails()" class="btn btn-secondary">Close</button>
    </div>
  </div>
</div>
