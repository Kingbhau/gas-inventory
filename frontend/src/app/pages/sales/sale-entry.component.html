<div class="sale-entry-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">New Sale Entry</h1>
    <p class="page-subtitle">Record a new sale transaction</p>
  </div>

  <!-- Sale Entry Form -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Sale Details</h3>
    </div>
    <div class="card-body">
      <form [formGroup]="saleForm" (ngSubmit)="onSubmit()" class="sale-form">
        <!-- Warehouse Selection (Autocomplete) -->
        <app-autocomplete-input
          label="Warehouse"
          [required]="true"
          [items]="warehouses"
          [displayKey]="'name'"
          placeholder="Warehouse name..."
          (selectedChange)="onWarehouseSelected($event)"
        ></app-autocomplete-input>
        <div *ngIf="saleForm.get('warehouseId')?.invalid && saleForm.get('warehouseId')?.touched" class="error-message">
          Warehouse is required
        </div>

        <!-- Customer Selection (Autocomplete) -->
        <app-autocomplete-input
          label="Customer"
          [required]="true"
          [items]="customers"
          [displayKey]="'name'"
          placeholder="Customer name..."
          (selectedChange)="onCustomerSelected($event)"
        ></app-autocomplete-input>
        <div *ngIf="saleForm.get('customerId')?.invalid && saleForm.get('customerId')?.touched" class="error-message">
          Customer is required
        </div>

        <!-- Variant Selection (Autocomplete) -->
        <app-autocomplete-input
          label="Cylinder Variant"
          [required]="true"
          [items]="filteredVariants"
          [displayKey]="'name'"
          placeholder="Variant name..."
          (selectedChange)="onVariantSelected($event)"
        ></app-autocomplete-input>
        <div *ngIf="saleForm.get('variantId')?.invalid && saleForm.get('variantId')?.touched" class="error-message">
          Variant is required
        </div>

        <!-- Two Column Layout -->
        <div class="form-row">
          <!-- Filled Cylinders Issued -->
          <div class="form-group">
            <label class="form-label">Filled Cylinders Issued <span class="required">*</span></label>
            <input 
              formControlName="filledIssuedQty" 
              type="number" 
              class="form-control" 
              placeholder="0"
              (change)="calculateTotal()">
            <div *ngIf="saleForm.get('filledIssuedQty')?.invalid && saleForm.get('filledIssuedQty')?.touched" class="error-message">
              Valid quantity required
            </div>
          </div>

          <!-- Empty Cylinders Received -->
          <div class="form-group">
            <label class="form-label">Empty Cylinders Received</label>
            <input 
              formControlName="emptyReceivedQty" 
              type="number" 
              class="form-control" 
              placeholder="0"
              (change)="calculateTotal()">
          </div>
        </div>

        <!-- Two Column Layout for Pricing -->
        <div class="form-row">
          <!-- Base Price -->
          <div class="form-group">
            <label class="form-label">Base Price Per Unit <span class="required">*</span></label>
            <div class="input-with-prefix">
              <span class="currency">₹</span>
              <input 
                formControlName="basePrice" 
                type="number" 
                class="form-control" 
                placeholder="0.00"
                [readonly]="true"
                (change)="calculateTotal()">
            </div>
            <div *ngIf="saleForm.get('basePrice')?.invalid && saleForm.get('basePrice')?.touched" class="error-message">
              Price required
            </div>
          </div>

          <!-- Discount Price (Read-only) -->
          <div class="form-group">
            <label class="form-label">Discount Amount Per Unit</label>
            <div class="input-with-prefix">
              <span class="currency">₹</span>
              <input 
                type="number" 
                class="form-control" 
                [value]="discountPrice"
                [readonly]="true"
                placeholder="0.00"
                (change)="calculateTotal()">
            </div>
          </div>
        </div>

        <!-- Summary Section -->
        <div class="summary-section">
          <div class="summary-row">
            <span class="summary-label">Quantity:</span>
            <span class="summary-value">{{ saleForm.get('filledIssuedQty')?.value || 0 }} units</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Base Price Per Unit:</span>
            <span class="summary-value">{{ saleForm.get('basePrice')?.value | indianCurrency }}</span>
          </div>
          <div class="summary-row" *ngIf="discountPrice > 0">
            <span class="summary-label">Discount Per Unit:</span>
            <span class="summary-value" style="color: #d32f2f;">-{{ discountPrice | indianCurrency }}</span>
          </div>
          <div class="summary-row" *ngIf="discountPrice > 0">
            <span class="summary-label">Price Per Unit After Discount:</span>
            <span class="summary-value" style="color: #28a745;">{{ (saleForm.get('basePrice')?.value - discountPrice) | indianCurrency }}</span>
          </div>
          <div class="summary-row" *ngIf="discountAmount > 0">
            <span class="summary-label">Total Discount (Savings):</span>
            <span class="summary-value" style="color: #28a745;">-{{ discountAmount | indianCurrency }}</span>
          </div>
          <div class="summary-row total">
            <span class="summary-label">Total Amount to Pay:</span>
            <span class="summary-value">{{ totalAmount | indianCurrency }}</span>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="!saleForm.valid">
            <span>✓</span> Save Sale
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">
            <span>↻</span> Reset
          </button>
        </div>
      </form>

      <!-- Success Message -->
      <div *ngIf="successMessage" class="success-alert">
        ✓ {{ successMessage }}
      </div>
    </div>
  </div>
</div>
